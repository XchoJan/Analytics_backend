export function buildSinglePrompt(matches: Array<{ homeTeam: string; awayTeam: string; date: string; time?: string; odds: { home: number; draw: number; away: number } }>, excludeMatches: string[] = []): string {
  const currentDate = new Date().toLocaleDateString('ru-RU', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  
  // Формируем детальную информацию о каждом матче
  const matchesInfo = matches.map((m, i) => {
    const matchStr = `${m.homeTeam} - ${m.awayTeam}`;
    const dateTime = `${m.date}${m.time ? ` ${m.time}` : ''}`;
    return `${i + 1}. ${matchStr} | Дата: ${dateTime} | Коэффициенты: П1=${m.odds.home}, X=${m.odds.draw}, П2=${m.odds.away}`;
  }).join('\n');
  
  return [
    "Ты - профессиональный AI аналитик спортивных матчей с глубокими знаниями футбола.",
    "Приложение НЕ принимает ставки и НЕ является букмекером.",
    "",
    `Сегодня ${currentDate}.`,
    "",
    "КРИТИЧЕСКИ ВАЖНАЯ ЗАДАЧА:",
    "Проанализируй ВСЕ матчи ниже с их РЕАЛЬНЫМИ коэффициентами букмекеров.",
    "Ты ДОЛЖЕН провести ГЛУБОКИЙ АНАЛИЗ каждого матча, учитывая:",
    "- Текущую форму команд (последние 5-10 матчей)",
    "- Статистику встреч между командами (если есть)",
    "- Состав команд, травмы, дисквалификации",
    "- Мотивацию команд (важность матча, турнирная ситуация)",
    "- Домашнее преимущество",
    "- Коэффициенты букмекеров (они отражают вероятность, но не всегда точно)",
    "",
    "ВАЖНО: НЕ выбирай просто матч с самым низким коэффициентом!",
    "Анализируй РЕАЛЬНЫЕ факторы и выбирай матч, где твой анализ показывает НАИБОЛЬШУЮ уверенность в прогнозе.",
    "КРИТИЧЕСКИ ВАЖНО: Разнообразь выбор! НЕ выбирай один и тот же матч каждый раз!",
    "Если есть список матчей, которые НЕ нужно выбирать (см. ниже) - ОБЯЗАТЕЛЬНО избегай их и выбери ДРУГОЙ матч!",
    "",
    "КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА ВЫВОДА:",
    "- Вывод ДОЛЖЕН быть ТОЛЬКО строгим JSON.",
    "- БЕЗ дополнительных ключей.",
    "- БЕЗ комментариев.",
    "- БЕЗ markdown.",
    "- БЕЗ дополнительного текста.",
    "- Числа должны быть реальными JSON числами (не строками).",
    "- Поле 'match' ДОЛЖНО быть ТОЧНО одним из матчей из списка ниже (переведи названия команд на русский).",
    "- Поле 'odds' ДОЛЖНО быть РЕАЛЬНЫМ коэффициентом из списка ниже для выбранного прогноза.",
    "",
    "Верни точно эту схему:",
    '{ "type":"single","match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА],"confidence":78 }',
    "",
    excludeMatches.length > 0 ? `\nВАЖНО: НЕ выбирай следующие матчи (они уже были выбраны недавно):\n${excludeMatches.map((m, i) => `${i + 1}. ${m}`).join('\n')}\n\n` : '',
    "Доступные РЕАЛЬНЫЕ матчи с коэффициентами (проанализируй ВСЕ и выбери ОДИН с наименьшим риском):",
    matchesInfo,
    "",
    "Разрешенные примеры для прогноза (на русском):",
    '- "Тотал больше 1.5"',
    '- "Тотал больше 2.5"',
    '- "Тотал меньше 2.5"',
    '- "Тотал меньше 3.5"',
    '- "Двойной шанс 1X"',
    '- "Двойной шанс X2"',
    '- "Победа хозяев" (используй коэффициент П1)',
    '- "Победа гостей" (используй коэффициент П2)',
    '- "Ничья" (используй коэффициент X)',
    "",
    "ВАЖНО: НЕ используй прогноз 'Обе команды забьют' - такой прогноз запрещен.",
    "",
    "ИНСТРУКЦИЯ ПО АНАЛИЗУ И ВЫБОРУ МАТЧА:",
    "1. Проанализируй КАЖДЫЙ матч из списка выше, учитывая форму, статистику, состав и мотивацию",
    "2. Коэффициенты букмекеров - это отправная точка, но не единственный фактор",
    "3. Выбери матч, где твой ПРОФЕССИОНАЛЬНЫЙ АНАЛИЗ показывает наивысшую уверенность",
    "4. КРИТИЧЕСКИ ВАЖНО: Разнообразь выбор! Не всегда выбирай матч с самым низким коэффициентом.",
    "   - Иногда выбирай матчи с коэффициентами 1.20-1.40 (высокая вероятность, но не всегда)",
    "   - Иногда выбирай матчи с коэффициентами 1.40-1.60 (средняя вероятность, но хороший анализ)",
    "   - Анализируй разные матчи каждый раз, не зацикливайся на одном",
    "5. Для выбранного матча используй РЕАЛЬНЫЙ коэффициент из списка (П1, X или П2)",
    "6. Коэффициент в ответе ДОЛЖЕН точно совпадать с одним из коэффициентов выбранного матча",
    "",
    "Проанализируй матчи выше ПРОФЕССИОНАЛЬНО и верни прогноз с НИЗКИМ РИСКОМ для ОДНОГО матча.",
    "Уверенность должна быть 70-85% для прогнозов с низким риском.",
    "Коэффициент ДОЛЖЕН быть РЕАЛЬНЫМ из списка выше (не придумывай его!).",
  ].join("\n");
}

export function buildExpressPrompt(matches: Array<{ homeTeam: string; awayTeam: string; date: string; time?: string; odds: { home: number; draw: number; away: number } }>, excludeMatches: string[] = []): string {
  const currentDate = new Date().toLocaleDateString('ru-RU', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  
  // Формируем детальную информацию о каждом матче
  const matchesInfo = matches.map((m, i) => {
    const matchStr = `${m.homeTeam} - ${m.awayTeam}`;
    const dateTime = `${m.date}${m.time ? ` ${m.time}` : ''}`;
    return `${i + 1}. ${matchStr} | Дата: ${dateTime} | Коэффициенты: П1=${m.odds.home}, X=${m.odds.draw}, П2=${m.odds.away}`;
  }).join('\n');
  
  return [
    "Ты - профессиональный AI аналитик спортивных матчей с глубокими знаниями футбола.",
    "Приложение НЕ принимает ставки и НЕ является букмекером.",
    "",
    `Сегодня ${currentDate}.`,
    "",
    "КРИТИЧЕСКИ ВАЖНАЯ ЗАДАЧА:",
    "Проанализируй ВСЕ матчи ниже с их РЕАЛЬНЫМИ коэффициентами букмекеров.",
    "Ты ДОЛЖЕН выбрать РОВНО ТРИ РАЗНЫХ матча для экспресс-прогноза x3.",
    "Выбери матчи с МИНИМАЛЬНЫМ РИСКОМ, но РАЗНООБРАЗЬ выбор - не всегда выбирай одни и те же матчи!",
    "",
    "КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА ВЫВОДА:",
    "- Вывод ДОЛЖЕН быть ТОЛЬКО строгим JSON.",
    "- Ровно 3 ставки в массиве `bets`.",
    "- Все 3 матча ДОЛЖНЫ быть разными.",
    "- Каждый матч ДОЛЖЕН быть ТОЧНО одним из матчей из списка ниже (переведи названия команд на русский).",
    "- БЕЗ дополнительных ключей.",
    "- БЕЗ комментариев.",
    "- БЕЗ markdown.",
    "- БЕЗ дополнительного текста.",
    "- Числа должны быть реальными JSON числами (не строками).",
    "- Поле 'odds' для каждой ставки ДОЛЖНО быть РЕАЛЬНЫМ коэффициентом из списка ниже для выбранного прогноза.",
    "- Рассчитай total_odds как произведение всех трех коэффициентов (умножь odds1 * odds2 * odds3).",
    "",
    "Верни точно эту схему:",
    '{ "type":"express","bets":[{"match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА]},{"match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА]},{"match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА]}],"total_odds":2.36,"confidence":65 }',
    "",
    excludeMatches.length > 0 ? `\nВАЖНО: НЕ выбирай следующие матчи (они уже были выбраны недавно):\n${excludeMatches.map((m, i) => `${i + 1}. ${m}`).join('\n')}\n\n` : '',
    "Доступные РЕАЛЬНЫЕ матчи с коэффициентами (выбери РОВНО 3 разных с минимальным риском):",
    matchesInfo,
    "",
    "Разрешенные примеры для прогноза (на русском):",
    '- "Тотал больше 1.5"',
    '- "Тотал больше 2.5"',
    '- "Тотал меньше 2.5"',
    '- "Тотал меньше 2"',
    '- "Двойной шанс 1X"',
    '- "Двойной шанс X2"',
    '- "Победа хозяев" (используй коэффициент П1)',
    '- "Победа гостей" (используй коэффициент П2)',
    '- "Ничья" (используй коэффициент X)',
    "",
    "ВАЖНО: НЕ используй прогноз 'Обе команды забьют' - такой прогноз запрещен.",
    "",
    "ИНСТРУКЦИЯ ПО ВЫБОРУ МАТЧЕЙ И ПРОГНОЗОВ:",
    "1. Проанализируй КАЖДЫЙ матч из списка выше, учитывая форму, статистику, состав и мотивацию",
    "2. Выбери РОВНО 3 РАЗНЫХ матча с минимальным риском",
    "3. КРИТИЧЕСКИ ВАЖНО: Разнообразь выбор! Не всегда выбирай одни и те же матчи!",
    "4. Если разброс между коэффициентами побед (П1, П2) слишком высокий (например, П1=1.10, П2=15.00),",
    "   то вместо прогноза на победу используй ТОТАЛЫ, НО С ОСТОРОЖНОСТЬЮ:",
    "   - 'Тотал больше 1.5' (если обе команды обычно забивают) - можно использовать в любых матчах",
    "   - 'Тотал меньше 2.5' - используй ТОЛЬКО если коэффициент победы слабой команды больше 6-7",
    "     (это означает, что слабая команда очень слабая и вряд ли забивет много)",
    "   - 'Тотал меньше 2' - используй ТОЛЬКО если коэффициент победы слабой команды больше 7-8",
    "   - ВАЖНО: НЕ используй тотал меньше 2.5 в обычных играх, где сильная команда может забивать по 4-5 голов!",
    "   - В обычных играх с сильными командами лучше использовать прогноз на победу или тотал больше",
    "5. Для каждого матча используй РЕАЛЬНЫЙ коэффициент из списка (П1, X, П2 или тотал)",
    "6. Коэффициент в ответе ДОЛЖЕН точно совпадать с одним из коэффициентов выбранного матча",
    "7. Рассчитай total_odds как произведение всех трех коэффициентов",
    "",
    "Проанализируй матчи выше ПРОФЕССИОНАЛЬНО и верни экспресс-прогноз с НИЗКИМ РИСКОМ для ТРЕХ матчей.",
    "Уверенность должна быть 60-75% для экспресс-прогноза.",
    "Все коэффициенты ДОЛЖНЫ быть РЕАЛЬНЫМИ из списка выше (не придумывай их!).",
  ].join("\n");
}

export function buildExpress5Prompt(matches: Array<{ homeTeam: string; awayTeam: string; date: string; time?: string; odds: { home: number; draw: number; away: number } }>, excludeMatches: string[] = []): string {
  const currentDate = new Date().toLocaleDateString('ru-RU', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  
  // Формируем детальную информацию о каждом матче
  const matchesInfo = matches.map((m, i) => {
    const matchStr = `${m.homeTeam} - ${m.awayTeam}`;
    const dateTime = `${m.date}${m.time ? ` ${m.time}` : ''}`;
    return `${i + 1}. ${matchStr} | Дата: ${dateTime} | Коэффициенты: П1=${m.odds.home}, X=${m.odds.draw}, П2=${m.odds.away}`;
  }).join('\n');
  
  return [
    "Ты - профессиональный AI аналитик спортивных матчей с глубокими знаниями футбола.",
    "Приложение НЕ принимает ставки и НЕ является букмекером.",
    "",
    `Сегодня ${currentDate}.`,
    "",
    "КРИТИЧЕСКИ ВАЖНАЯ ЗАДАЧА:",
    "Проанализируй ВСЕ матчи ниже с их РЕАЛЬНЫМИ коэффициентами букмекеров.",
    "Ты ДОЛЖЕН выбрать РОВНО ПЯТЬ РАЗНЫХ матчей для экспресс-прогноза x5.",
    "Выбери матчи с МИНИМАЛЬНЫМ РИСКОМ, но РАЗНООБРАЗЬ выбор - не всегда выбирай одни и те же матчи!",
    "",
    "КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА ВЫВОДА:",
    "- Вывод ДОЛЖЕН быть ТОЛЬКО строгим JSON.",
    "- Ровно 5 ставок в массиве `bets`.",
    "- Все 5 матчей ДОЛЖНЫ быть разными.",
    "- Каждый матч ДОЛЖЕН быть ТОЧНО одним из матчей из списка ниже (переведи названия команд на русский).",
    "- БЕЗ дополнительных ключей.",
    "- БЕЗ комментариев.",
    "- БЕЗ markdown.",
    "- БЕЗ дополнительного текста.",
    "- Числа должны быть реальными JSON числами (не строками).",
    "- Поле 'odds' для каждой ставки ДОЛЖНО быть РЕАЛЬНЫМ коэффициентом из списка ниже для выбранного прогноза.",
    "- Рассчитай total_odds как произведение всех пяти коэффициентов (умножь odds1 * odds2 * odds3 * odds4 * odds5).",
    "",
    "Верни точно эту схему:",
    '{ "type":"express5","bets":[{"match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА]},{"match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА]},{"match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА]},{"match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА]},{"match":"[МАТЧ НА РУССКОМ ИЗ СПИСКА]","prediction":"[ПРОГНОЗ НА РУССКОМ]","odds":[РЕАЛЬНЫЙ КОЭФФИЦИЕНТ ИЗ СПИСКА]}],"total_odds":3.50,"confidence":55 }',
    "",
    excludeMatches.length > 0 ? `\nВАЖНО: НЕ выбирай следующие матчи (они уже были выбраны недавно):\n${excludeMatches.map((m, i) => `${i + 1}. ${m}`).join('\n')}\n\n` : '',
    "Доступные РЕАЛЬНЫЕ матчи с коэффициентами (выбери РОВНО 5 разных с минимальным риском):",
    matchesInfo,
    "",
    "Разрешенные примеры для прогноза (на русском):",
    '- "Тотал больше 1.5"',
    '- "Тотал больше 2.5"',
    '- "Тотал меньше 2.5"',
    '- "Тотал меньше 2"',
    '- "Двойной шанс 1X"',
    '- "Двойной шанс X2"',
    '- "Победа хозяев" (используй коэффициент П1)',
    '- "Победа гостей" (используй коэффициент П2)',
    '- "Ничья" (используй коэффициент X)',
    "",
    "ВАЖНО: НЕ используй прогноз 'Обе команды забьют' - такой прогноз запрещен.",
    "",
    "ИНСТРУКЦИЯ ПО ВЫБОРУ МАТЧЕЙ И ПРОГНОЗОВ:",
    "1. Проанализируй КАЖДЫЙ матч из списка выше, учитывая форму, статистику, состав и мотивацию",
    "2. Выбери РОВНО 5 РАЗНЫХ матчей с минимальным риском",
    "3. КРИТИЧЕСКИ ВАЖНО: Разнообразь выбор! Не всегда выбирай одни и те же матчи!",
    "4. Если разброс между коэффициентами побед (П1, П2) слишком высокий (например, П1=1.10, П2=15.00),",
    "   то вместо прогноза на победу используй ТОТАЛЫ, НО С ОСТОРОЖНОСТЬЮ:",
    "   - 'Тотал больше 1.5' (если обе команды обычно забивают) - можно использовать в любых матчах",
    "   - 'Тотал меньше 2.5' - используй ТОЛЬКО если коэффициент победы слабой команды больше 6-7",
    "     (это означает, что слабая команда очень слабая и вряд ли забивет много)",
    "   - 'Тотал меньше 2' - используй ТОЛЬКО если коэффициент победы слабой команды больше 7-8",
    "   - ВАЖНО: НЕ используй тотал меньше 2.5 в обычных играх, где сильная команда может забивать по 4-5 голов!",
    "   - В обычных играх с сильными командами лучше использовать прогноз на победу или тотал больше",
    "5. Для каждого матча используй РЕАЛЬНЫЙ коэффициент из списка (П1, X, П2 или тотал)",
    "6. Коэффициент в ответе ДОЛЖЕН точно совпадать с одним из коэффициентов выбранного матча",
    "7. Рассчитай total_odds как произведение всех пяти коэффициентов",
    "",
    "Проанализируй матчи выше ПРОФЕССИОНАЛЬНО и верни экспресс-прогноз с НИЗКИМ РИСКОМ для ПЯТИ матчей.",
    "Уверенность должна быть 50-65% для экспресс-прогноза x5.",
    "Все коэффициенты ДОЛЖНЫ быть РЕАЛЬНЫМИ из списка выше (не придумывай их!).",
  ].join("\n");
}

export function buildMatchAnalysisPrompt(match: string, league?: string, date?: string): string {
  const currentDate = new Date().toLocaleDateString('ru-RU', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  return [
    "Ты - AI аналитик спортивных матчей.",
    "Приложение НЕ принимает ставки и НЕ является букмекером.",
    "",
    `Сегодня ${currentDate}.`,
    "",
    `Задача: Проанализируй следующий РЕАЛЬНЫЙ футбольный матч и предоставь прогноз с оценкой риска.`,
    "",
    `Матч: ${match}`,
    league ? `Лига: ${league}` : "",
    date ? `Дата: ${date}` : "",
    "",
    "КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА ВЫВОДА:",
    "- Вывод ДОЛЖЕН быть ТОЛЬКО строгим JSON.",
    "- БЕЗ дополнительных ключей.",
    "- БЕЗ комментариев.",
    "- БЕЗ markdown.",
    "- БЕЗ дополнительного текста.",
    "- Числа должны быть реальными JSON числами (не строками).",
    "- Все тексты (название матча, прогноз) ДОЛЖНЫ быть на РУССКОМ языке.",
    "- Переведи названия команд на русский язык, если они на английском.",
    "",
    "Верни точно эту схему:",
    '{ "match":"[НАЗВАНИЕ МАТЧА НА РУССКОМ]","prediction":"[ПРОГНОЗ НА РУССКОМ]","riskPercent":25,"odds":1.50 }',
    "",
    "Разрешенные примеры для прогноза (на русском):",
    '- "Тотал больше 1.5"',
    '- "Тотал больше 2.5"',
    '- "Тотал меньше 2.5"',
    '- "Тотал меньше 3.5"',
    '- "Двойной шанс 1X"',
    '- "Двойной шанс X2"',
    '- "Победа хозяев"',
    '- "Победа гостей"',
    '- "Ничья"',
    "",
    "ВАЖНО: НЕ используй прогноз 'Обе команды забьют' - такой прогноз запрещен.",
    "",
    "КРИТИЧЕСКИ ВАЖНО - РЕАЛЬНЫЕ КОЭФФИЦИЕНТЫ:",
    "Ты ДОЛЖЕН найти РЕАЛЬНЫЕ коэффициенты букмекеров для этого матча в интернете.",
    "НЕ рассчитывай коэффициент самостоятельно! НЕ придумывай коэффициент!",
    "Используй информацию из интернета, которую тебе предоставили выше.",
    "",
    "Требования к анализу:",
    "1. Найди в предоставленной информации из интернета РЕАЛЬНЫЕ коэффициенты букмекеров для этого матча",
    "2. Если в информации есть коэффициенты от букмекеров (1xBet, Bet365, Fonbet, Parimatch и т.д.) - используй их",
    "3. Выбери наиболее подходящий прогноз с РЕАЛЬНЫМ коэффициентом из букмекеров",
    "4. Если реальных коэффициентов нет в информации, попробуй найти их через поиск",
    "5. Проанализируй форму команд, историю очных встреч, недавние результаты",
    "6. Учти преимущество домашнего поля, травмы, мотивацию",
    "7. Предоставь конкретный прогноз с РЕАЛЬНЫМ коэффициентом из букмекеров",
    "",
    "Процент риска:",
    "- Рассчитай процент риска на основе анализа: меньше = безопаснее ставка (0-100%)",
    "- Процент риска: 0-30% = очень безопасно, 31-50% = безопасно, 51-70% = умеренно, 71-100% = рискованно",
    "",
    "КРИТИЧЕСКИ ВАЖНО О КОЭФФИЦИЕНТЕ:",
    "- Коэффициент ДОЛЖЕН быть РЕАЛЬНЫМ из букмекеров, который ты найдешь в информации из интернета",
    "- Если в информации из интернета указан коэффициент 2.80 - верни ТОЧНО 2.80, а НЕ 1.60!",
    "- Если в информации указан коэффициент 1.60 - верни ТОЧНО 1.60, а НЕ другой!",
    "- Коэффициент должен ТОЧНО соответствовать тому, что указано в информации из интернета",
    "- Коэффициент должен быть в диапазоне 1.0-10.0 (реальные коэффициенты букмекеров)",
    "- НЕ придумывай коэффициент! НЕ рассчитывай его математически!",
    "- НЕ используй примеры из схемы (1.50) как реальный коэффициент!",
    "- Если в информации НЕТ реальных коэффициентов - верни 0 или очень высокое значение (99.99)",
    "- ВАЖНО: Коэффициент в ответе ДОЛЖЕН точно совпадать с коэффициентом из информации выше!",
    "",
    "Верни ТОЛЬКО JSON объект, больше ничего.",
  ].filter(line => line !== "").join("\n");
}

